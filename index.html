<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>ChoosGo</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!--Font-->
    <link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
    <!-- Custom CSS -->
    <link href="css/stylish-portfolio.css" rel="stylesheet">

    <!-- Custom Drop Downs -->
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/cs-select.css" />
    <link rel="stylesheet" type="text/css" href="css/cs-skin-slide.css" />

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!--ChoosGo Stuff-->
    <script src="http://ajax.aspnetcdn.com/ajax/mobileservices/MobileServices.Web-1.2.7.min.js"></script>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <meta name="viewport" content="initial-scale=1.0, width=device-width" /> 
    <script src="http://js.api.here.com/v3/3.0/mapsjs-core.js" 
            type="text/javascript" charset="utf-8"></script> 
    <script src="http://js.api.here.com/v3/3.0/mapsjs-service.js" 
            type="text/javascript" charset="utf-8"></script> 
</head>

<body>
    <!-- Header -->
    <header id="top" class="header">
        <div class="text-vertical-center">
            <h1>Welcome to ChoosGo</h1>
            <h3>You Have Fun, We'll Do The Planning</h3>
        </div>
    </header>

    <!-- Selection Menu -->
    <section id="about" class="plannedDay">
        <br>
        <br>
        <br>

        <select id ="city" class="cs-select cs-skin-slide">
            <option value="City"> City </option>
            <option value="San Francisco"> San Francisco </option>
            <option value="Boston"> Boston </option>
            <option value="Chicago"> Chicago </option>
            <option value="Seattle"> Seattle </option>
            <option value="New York"> New York </option>
        </select>
<br>
        <select id="priceRange" class="cs-select cs-skin-slide">
            <option value=""> Price Range </option>
            <option value="--"> -- </option>
            <option value="$"> $ </option>
            <option value="$$"> $$ </option>
            <option value="$$$"> $$$ </option>
            <option value="$$$$"> $$$$ </option>
        </select>
<br>
        <select id="Transport" class="cs-select cs-skin-slide">
            <option value=""> Transportation </option>
            <option value="Walking"> Walking </option>
            <option value="Biking"> Biking </option>
            <option value="PublicTransport"> Public Transport </option>
            <option value="Car"> Car </option>
        </select>
<br>
        <select id="companions" class="cs-select cs-skin-slide">
            <option value="Reached"> Companions </option>
            <option value="Walking"> Family </option>
            <option value="Biking"> Friends </option>
            <option value="PublicTransport"> Acquaintances </option>
            <option value="PublicTransport"> Significant Other </option>
        </select>

        <form class="form-style-4" action="" method="post">
            <label for="field1">
                <span>City Name</span><input type="text" id="city1" required="true" />
            </label>
            <label>
                <span>&nbsp;</span><input type="button" onclick = "updateCityList1()" value="Plan!" />
            </label>
        </form>

        <p><input type="submit" value="Plan!" class="midnight-blue-flat-button" onclick="updateCityList()">
        </p>
    </section>
    <!--Day Plan-->
    <section id = "dayPlan" class = "dayPlanned">
            <div id="container">
                <div class="pricetab">
                    <h1 id="1"> Activity 1 </h1>
                    <div class="price">
                        <span> <img class = "picture" height = 100px id = "1img" src="http://orig15.deviantart.net/654a/f/2012/269/0/3/panda_png__3_by_kairiedits-d5fz1x8.png" </span>
                    </div>
                    <div class="infos">
                        <h3> 9:30 - 12:30 AM </h3>
                        <h3> Coordinates to Address </h3>
                        <h3> Uber Cost </h3>
                        <h3> Capital One Payment </h3>
                        <h3> Moxtra, and Magnet Integration </h3>
                    </div>
                </div>

                <div class="pricetab">
                    <h1 id="2"> Activity 2 </h1>
                    <div class="price">
                        <span> <img class = "picture" height = 100px id = "2img" src="http://orig15.deviantart.net/654a/f/2012/269/0/3/panda_png__3_by_kairiedits-d5fz1x8.png" </span>
                    </div>
                    <div class="infos">
                        <h3> 12:30 - 3:30 PM </h3>
                        <h3> Coordinates to Address </h3>
                        <h3> Uber Cost </h3>
                        <h3> Capital One Payment </h3>
                        <h3> Moxtra, and Magnet Integration </h3>
                    </div>
                </div>

                <div class="pricetab">
                    <h1 id = "3"> Activity 3 </h1>
                    <div class="price">
                        <span> <img class = "picture" height = 100px id = "3img" src="http://orig15.deviantart.net/654a/f/2012/269/0/3/panda_png__3_by_kairiedits-d5fz1x8.png" </span>
                    </div>
                    <div class="infos">
                        <h3> 3:30 - 6:30 PM </h3>
                        <h3> Coordinates to Address </h3>
                        <h3> Uber Cost </h3>
                        <h3> Capital One Payment </h3>
                        <h3> Moxtra, and Magnet Integration </h3>
                    </div>
                </div>

                <div class="pricetab">
                    <h1 id = "4"> Activity 4 </h1>
                    <div class="price">
                        <span> <img class = "picture" height = 100px id = "4img" src="http://orig15.deviantart.net/654a/f/2012/269/0/3/panda_png__3_by_kairiedits-d5fz1x8.png" </span>
                    </div>
                    <div class="infos">
                        <h3> 6:30 - 9:30 PM </h3>
                        <h3> Coordinates to Address </h3>
                        <h3> Uber Cost </h3>
                        <h3> Capital One Payment </h3>
                        <h3> Moxtra, and Magnet Integration </h3>
                    </div>
                </div>

                <div class="pricetab">
                    <h1 id="5"> Activity 5 </h1>
                    <div class="price">
                        <span> <img class = "picture" height = 100px id = "5img" src="http://orig15.deviantart.net/654a/f/2012/269/0/3/panda_png__3_by_kairiedits-d5fz1x8.png" </span>
                    </div>
                    <div class="infos">
                        <h3> 9:30 - 12:30 AM </h3>
                        <h3> Coordinates to Address </h3>
                        <h3> Uber Cost </h3>
                        <h3> Capital One Payment </h3>
                        <h3> Moxtra, and Magnet Integration </h3>
                    </div>
                </div>
            </div>
        <h2 id="load" class = "intro"></h2>
    </section>

    <script>
        function updateCityList1(){
            var city = document.getElementById("city1").value;
            document.getElementById("load").innerHTML = "Loading";
            addCity(city);
        }

        function updateCityList(){
            var city = document.getElementById("city").value;
            document.getElementById("load").innerHTML = "Loading";
            addCity(city);
        }

        function fillDay(informationStored){
            informationStored = parseData(informationStored);
            var counter = 1;
            for(var looper in informationStored){
                document.getElementById(counter.toString()).innerHTML = looper;
                document.getElementById(counter.toString().concat("img")).src = informationStored[looper].imgLink;
                if(counter == 5){
                    break;
                }
                counter += 1;
            }
            setWaypoints(informationStored);
        }

        function parseData(informationStored){
            var tallyX = 0;
            var tallyY = 0;
            var count = 0;
            for(var looper in informationStored){
                if(informationStored[looper].coordinates.match(/[a-z]/i)|| informationStored[looper] == null) {
                    delete informationStored[looper];
                }
                else{
                    var coordinatePair = informationStored[looper].coordinates.split(",");
                    tallyX = tallyX + parseFloat(coordinatePair[0]);
                    tallyY = tallyY + parseFloat(coordinatePair[1]);
                    count += 1;
                }
            }
            tallyX = tallyX/count;
            tallyY = tallyY/count;

            for(var looper in informationStored){
                var coordinatePair = informationStored[looper].coordinates.split(",");
                if(parseFloat(coordinatePair[0]) > tallyX + 1.5 || parseFloat(coordinatePair[0]) < tallyX - 1.5){
                    delete informationStored[looper];
                }
                else if(parseFloat(coordinatePair[1]) > tallyY + 1.5 || parseFloat(coordinatePair[1]) < tallyY - 1.5){
                    delete informationStored[looper];
                }
            }
            return informationStored;
        }
    </script>

    <section>
        <div id='mapContainer' class = "mapR")> </div>
    </section>

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <script src="js/classie.js"></script>
    <script src="js/selectFx.js"></script>
    <script>
        (function() {
            [].slice.call( document.querySelectorAll( 'select.cs-select' ) ).forEach( function(el) {
                new SelectFx(el);
            } );
        })();
    </script>

    <script>
        var informationStored = {};
        var client = new WindowsAzure.MobileServiceClient(
                "https://choosgo.azure-mobile.net/",
                "pOcvEDYJeHjLDeRsaDcQZXFzeBREJm96"
        );

        function addCity(city){
            client = new WindowsAzure.MobileServiceClient(
                    "https://choosgo.azure-mobile.net/",
                    "pOcvEDYJeHjLDeRsaDcQZXFzeBREJm96"
            );
            client.invokeApi("bing_query", {
                body: null,
                parameters: {city: city},
                method: "post"
            }).done(function (results) {
                informationStored = {};
                var map = results.result.message;
                var totalLength = Object.keys(map).length;
                for(var title in map) {
                    var path = map[title];
                    addMonuments(title, path, totalLength);
                }
            }, function(error) {
                console.log(error);
            });
        }
        function addMonuments(title, path, totalLength){
            client.invokeApi("individual_query", {
                body: null,
                parameters: {path: path.searchquery},
                method: "post"
            }).done(function (rslts) {
                        var m = rslts.result.message;
                        informationStored[title] = { coordinates: m, searchquery: path.searchquery,imgLink: path.img};
                        document.getElementById("load").innerHTML = "Fun Awaits!"
                        if(Object.keys(informationStored).length >= totalLength) {
                            document.getElementById("load").innerHTML = "";
                            fillDay(informationStored);
                        }
                    },
                    function(error) {
                        console.log(error);
                    });
        }

    </script>

    <script type="text/javascript">
        //auto expand textarea
        function adjust_textarea(h) {
            h.style.height = "20px";
            h.style.height = (h.scrollHeight)+"px";
        }
    </script>

    <script>
        var platform = new H.service.Platform({
            'app_id': 'zrVgyWR41xcFCQZBicxr',
            'app_code': 'HzXEYVx1Ev27bNQCrCPZ7A'
        });
        // Obtain the default map types from the platform object:
        var defaultLayers = platform.createDefaultLayers();
        var routingParameters = {};
        var map = {};
        //sets coordinates for waypoints
        function setWaypoints (info){
            var array = new Array();
            var count = 0;
            for (var looper in info) {
                array[count] = 'geo!'.concat(info[looper].coordinates);
                count += 1;
                if(count >= 5)
                break;
            }
            routingParameters = {
                // The routing mode:
                'mode': 'fastest;car',
                // The start point of the route:
                'waypoint0': array[0],
                'waypoint1': array[1],
                // The end point of the route:
                'waypoint2': array[2],
                'waypoint3': array[3],
                'waypoint4': array[4],
                // To retrieve the shape of the route we choose the route
                // representation mode 'display'
                'representation': 'display'
            };
            drawMap(info);
            putPoints();
        }

        function drawMap (info) {
            // Create the parameters for the routing request:
            var avgLat = 0;
            var avgLon = 0;
            var count = 4;
            for (var loop in info) {
                var coordinatePair = info[loop].coordinates.split(",");
                console.log(coordinatePair);
                avgLat = avgLat + (parseFloat(coordinatePair[0]))/5;
                avgLon = avgLon + (parseFloat(coordinatePair[1]))/5;
                if(count == 0)
                break;
                count -= 1;
            }

            map = new H.Map(
                    document.getElementById('mapContainer'),
                    defaultLayers.satellite.map,
                    {
                        zoom: 10,
                        center: { lat: avgLat, lng: avgLon}
                    });
        }

        // Define a callback function to process the routing response:
        function putPoints() {
            var onResult = function(result) {
                var route,
                        routeShape,
                        startPoint,
                        midPoint0,
                        midPoint1,
                        midPoint2,
                        endPoint,
                        strip;
                if(result.response.route) {
                    // Pick the first route from the response:
                    route = result.response.route[0];
                    // Pick the route's shape:
                    routeShape = route.shape;

                    // Create a strip to use as a point source for the route line
                    strip = new H.geo.Strip();

                    // Push all the points in the shape into the strip:
                    routeShape.forEach(function(point) {
                        var parts = point.split(',');
                        strip.pushLatLngAlt(parts[0], parts[1]);
                    });

                    // Retrieve the mapped positions of the requested waypoints:
                    startPoint = route.waypoint[0].mappedPosition;
                    midPoint0 = route.waypoint[1].mappedPosition;
                    midPoint1 = route.waypoint[2].mappedPosition;
                    midPoint2 = route.waypoint[3].mappedPosition;
                    endPoint = route.waypoint[4].mappedPosition;

                    // Create a polyline to display the route:
                    var routeLine = new H.map.Polyline(strip, {
                        style: { strokeColor: 'blue', lineWidth: 10 }
                    });
                    // Create a marker for the start point:
                    var startMarker = new H.map.Marker({
                        lat: startPoint.latitude,
                        lng: startPoint.longitude
                    });

                    var midMarker0 = new H.map.Marker({
                        lat: midPoint0.latitude,
                        lng: midPoint0.longitude
                    });

                    var midMarker1 = new H.map.Marker({
                        lat: midPoint1.latitude,
                        lng: midPoint1.longitude
                    });

                    var midMarker2 = new H.map.Marker({
                        lat: midPoint2.latitude,
                        lng: midPoint2.longitude
                    });
                    // Create a marker for the end point:
                    var endMarker = new H.map.Marker({
                        lat: endPoint.latitude,
                        lng: endPoint.longitude
                    });

                    // Add the route polyline and the two markers to the map:
                    map.addObjects([startMarker, midMarker0, midMarker1, midMarker2, endMarker, routeLine]);

                    // Set the map's viewport to make the whole route visible:
                    map.setViewBounds(routeLine.getBounds());
                }
            };

            // Get an instance of the routing service:
            var router = platform.getRoutingService();

            // Call calculateRoute() with the routing parameters,
            // the callback and an error callback function (called if a
            // communication error occurs):
            router.calculateRoute(routingParameters, onResult,
                    function(error) {
                        alert(error.message);
                    });
            setWaypoints(info);
        }
    </script>

</body>

</html>
