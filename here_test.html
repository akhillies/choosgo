<!DOCTYPE html>
<html>
<head>
  <script src="http://js.api.here.com/v3/3.0/mapsjs-core.js"
  type="text/javascript" charset="utf-8"></script>
  <script src="http://js.api.here.com/v3/3.0/mapsjs-service.js"
  type="text/javascript" charset="utf-8"></script>
  <meta name="viewport" content="initial-scale=1.0, width=device-width" />
</head>
<body>
  <div id='mapContainer' style="position:absolute; width:100%; height:49%; background:grey"> </div>
  <script>
    var platform = new H.service.Platform({
      'app_id': 'zrVgyWR41xcFCQZBicxr',
      'app_code': 'HzXEYVx1Ev27bNQCrCPZ7A'
    });
    // Obtain the default map types from the platform object:
    var defaultLayers = platform.createDefaultLayers();

    // Instantiate (and display) a map object:
    var map = new H.Map(
        document.getElementById('mapContainer'),
        defaultLayers.satellite.map,
        {
         zoom: 10,
         center: { lat: 50, lng: 50.4 }
        });
  
    
    

    //sets coordinates for waypoints
    function setWaypoints (Object info){
      var array = new Array();
      array[0] = 'geo!50.1120423728813,8.68340740740811';
      var count = 0;
      for (var looper in info) {
        array[count] = 'geo!'.concat(info.looper[0]).concat(',').concat(info.looper[1]);
        count += 1;
      }
      var routingParameters = {
      // The routing mode:
        'mode': 'fastest;car',
        // The start point of the route:
        'waypoint0': array[0],
        'waypoint1': array[1],
        // The end point of the route:
        'waypoint2': array[2],
        'waypoint3': array[3],
        'waypoint4': array[4],
        // To retrieve the shape of the route we choose the route
        // representation mode 'display'
        'representation': 'display'
      };
      drawMap(info);
      putPoints();
    }

    function drawMap (Object info) {
      // Create the parameters for the routing request:
      var avgLat = 0;
      var avgLon = 0;
      for (var looper in info) {
        avgLat = avgLat + (Float.parseFloat(info.looper[0]))/5;
        avgLon = avgLon + (Float.parseFloat(info.looper[1]))/5;
      }
      
      var map = new H.Map(
        document.getElementById('mapContainer'),
        defaultLayers.satellite.map,
        {
         zoom: 10,
         center: { lat: avgLat, lng: avgLon}
        });
    }

    // Define a callback function to process the routing response:
    function putPoints() {
    var onResult = function(result) {
      var route,
          routeShape,
          startPoint,
          midPoint0,
          midPoint1,
          midPoint2,
          endPoint,
          strip;
      if(result.response.route) {
        // Pick the first route from the response:
        route = result.response.route[0];
        // Pick the route's shape:
        routeShape = route.shape;

        // Create a strip to use as a point source for the route line
        strip = new H.geo.Strip();

        // Push all the points in the shape into the strip:
        routeShape.forEach(function(point) {
          var parts = point.split(',');
          strip.pushLatLngAlt(parts[0], parts[1]);
        });

        // Retrieve the mapped positions of the requested waypoints:
        startPoint = route.waypoint[0].mappedPosition;
        midPoint0 = route.waypoint[1].mappedPosition;
        midPoint1 = route.waypoint[2].mappedPosition;
        midPoint2 = route.waypoint[3].mappedPosition;
        endPoint = route.waypoint[4].mappedPosition;

        // Create a polyline to display the route:
        var routeLine = new H.map.Polyline(strip, {
          style: { strokeColor: 'blue', lineWidth: 10 }
        });
        // Create a marker for the start point:
        var startMarker = new H.map.Marker({
          lat: startPoint.latitude,
          lng: startPoint.longitude
        });

        var midMarker0 = new H.map.Marker({
          lat: midPoint0.latitude,
          lng: midPoint0.longitude
        });

        var midMarker1 = new H.map.Marker({
          lat: midPoint1.latitude,
          lng: midPoint1.longitude
        });

        var midMarker2 = new H.map.Marker({
          lat: midPoint2.latitude,
          lng: midPoint2.longitude
        });
        // Create a marker for the end point:
        var endMarker = new H.map.Marker({
          lat: endPoint.latitude,
          lng: endPoint.longitude
        });

        // Add the route polyline and the two markers to the map:
        map.addObjects([startMarker, midMarker0, midMarker1, midMarker2, endMarker, routeLine]);

        // Set the map's viewport to make the whole route visible:
        map.setViewBounds(routeLine.getBounds());
        }
        };

        // Get an instance of the routing service:
        var router = platform.getRoutingService();

        // Call calculateRoute() with the routing parameters,
        // the callback and an error callback function (called if a
        // communication error occurs):
        console.log(routingParameters);
        router.calculateRoute(routingParameters, onResult,
        function(error) {
            alert(error.message);
        });
      }
  </script>
</body>
</html>

